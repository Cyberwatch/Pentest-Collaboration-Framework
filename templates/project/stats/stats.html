<!DOCTYPE html>
<html lang="en">
{% if external_js %}
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
{% else %}
    <script type="text/javascript" src="/static/js/apexcharts.js"></script>
{% endif %}
{% include 'header.html' %}
<body style="height: 100%">
<div id="segment_id" style="height: 100%">
    {% include 'menu.html' %}
    <div class="ui grid" style="height: calc(100% - 40px)">
        <div class="ui column" style="width: 80px; padding-top: 50px; max-height: 100%">
            {% include 'project/sidebar.html' %}
        </div>
        {% set stats_dict = db.project_stats(current_project['id']) %}
        <div class="ui column" style="width: calc(100% - 80px); height: 100% ">
            <script>
                function escapeHtml(text) {
                    var map = {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#039;'
                    };

                    return text.replace(/[&<>"']/g, function (m) {
                        return map[m];
                    });
                }

                function switch_host(host_key) {
                    for (var key in tmp_list) {
                        if (key === host_key) {
                            if (tmp_list[key]["selected"] === "")
                                tmp_list[key]["selected"] = "checked";
                            else
                                tmp_list[key]["selected"] = "";
                            return true;
                        }
                    }
                }

                function show_calendar(date) {
                    var currentDate = new Date();

                    var day = currentDate.getDate();
                    var month = currentDate.getMonth() + 1;
                    var year = currentDate.getFullYear();

                    today = month + "/" + day + "/" + year;

                    var future = new Date();
                    future.setDate(future.getDate() + 30);

                    day = future.getDate();
                    month = future.getMonth() + 1;
                    year = future.getFullYear();

                    month = month + "/" + day + "/" + year;

                    $('#start_date')[0].value = today;
                    $('#end_date')[0].value = month;

                    $('#rangestart').calendar({
                        type: 'date',
                        endCalendar: $('#rangeend'),
                        formatter: {
                            date: function (date, settings) {
                                if (!date) return '1/1/1970';
                                var day = date.getDate();
                                var month = date.getMonth() + 1;
                                var year = date.getFullYear();
                                return day + '/' + month + '/' + year;
                            }
                        }
                    });


                    $('#rangeend').calendar({
                        type: 'date',
                        startCalendar: $('#rangestart'),
                        formatter: {
                            date: function (date, settings) {
                                if (!date) return '1/1/3000';
                                var day = date.getDate();
                                var month = date.getMonth() + 1;
                                var year = date.getFullYear();
                                return day + '/' + month + '/' + year;
                            }
                        }
                    });
                }

                function set_calendars(start_int, finish_int) {
                    if (start_int !== 0) {
                        start_date = new Date(start_int * 1000);

                        day = start_date.getDate();
                        month = start_date.getMonth() + 1;
                        year = start_date.getFullYear();

                        start_str = month + "/" + day + "/" + year;
                        $('#start_date')[0].value = start_str;
                    }
                    if (finish_int !== 0) {
                        finish_date = new Date(finish_int * 1000);

                        day = finish_date.getDate();
                        month = finish_date.getMonth() + 1;
                        year = finish_date.getFullYear();

                        finish_str = month + "/" + day + "/" + year;
                        $('#end_date')[0].value = finish_str;
                    }

                    $('#rangestart').calendar({
                        type: 'date',
                        endCalendar: $('#rangeend'),
                        formatter: {
                            date: function (date, settings) {
                                if (!date) return '1/1/1970';
                                var day = date.getDate();
                                var month = date.getMonth() + 1;
                                var year = date.getFullYear();
                                return day + '/' + month + '/' + year;
                            }
                        }
                    });


                    $('#rangeend').calendar({
                        type: 'date',
                        startCalendar: $('#rangestart'),
                        formatter: {
                            date: function (date, settings) {
                                if (!date) return '1/1/3000';
                                var day = date.getDate();
                                var month = date.getMonth() + 1;
                                var year = date.getFullYear();
                                return day + '/' + month + '/' + year;
                            }
                        }
                    });
                }

                function show_hosts(search_string) {
                    i = 0;

                    list_elem = $('#hosts_list')[0];

                    shown_html = "";
                    text_html = "";

                    counter = 0;

                    for (var key in tmp_list) {
                        i++;
                        val = tmp_list[key]["text"];
                        text = escapeHtml(tmp_list[key]["text"]);

                        if (val.includes(search_string.toLowerCase()) || search_string === '') {
                            counter += 1
                            check_str = tmp_list[key]["selected"];

                            inner = `<div class="ui item checkbox" id="host_row">
                                <input type="checkbox" name="host-${i}" value="${key}" ${check_str} onchange="switch_host('${key}')">
                                <label>${text}</label>
                            </div>`

                            if (check_str === "checked") {
                                shown_html += inner;
                            } else {
                                text_html += inner;
                            }
                        }
                    }

                    if (counter > 1000) {
                        shown_html = shown_html + `<div class="ui item" id="host_row">
                                <label>Too much results (${counter})..</label>
                            </div>`;
                        list_elem.innerHTML = shown_html;
                    } else {
                        list_elem.innerHTML = shown_html + text_html;
                    }

                    $('#host_row').checkbox();
                    $('.ui.checkbox').checkbox();
                }

                var ips = [];
                var hostnames = [];
                var full_select_list = {};
                var tmp_list = {};

                var users = {{ json_pack(project_users) | safe}};
                var teams = {{ json_pack(project_teams) | safe}};

                hosts_loaded = false;

                $(document).ready(function () {
                    $('.menu .item')
                        .tab({
                            history: true
                        });


                    $.getJSON("/project/{{ current_project['id'] }}/issues/hosts_ports_list", function (j) {
                        ips = j.ips;
                        hostnames = j.hostnames;

                        // {"__port_id__:__hostname_id__" : "ip:port"}

                        for (const ip_obj of ips) {
                            full_select_list[ip_obj["port_id"] + ":0"] = {}
                            full_select_list[ip_obj["port_id"] + ":0"]["text"] = ip_obj["ip"];
                            if (!(ip_obj["port"] === 0)) {
                                full_select_list[ip_obj["port_id"] + ":0"]["text"] += ":" + ip_obj["port"];
                                if (ip_obj["is_tcp"] === 1) {
                                    full_select_list[ip_obj["port_id"] + ":0"]["text"] += '/tcp';
                                } else {
                                    full_select_list[ip_obj["port_id"] + ":0"]["text"] += '/udp';
                                }
                            }
                            full_select_list[ip_obj["port_id"] + ":0"]["selected"] = "";
                        }

                        for (const hostname_obj of hostnames) {
                            full_select_list[hostname_obj["port_id"] + ":" + hostname_obj["hostname_id"]] = {}
                            full_select_list[hostname_obj["port_id"] + ":" + hostname_obj["hostname_id"]]["text"] = hostname_obj["hostname"];
                            if (!(hostname_obj["port"] === 0)) {
                                full_select_list[hostname_obj["port_id"] + ":" + hostname_obj["hostname_id"]]["text"] += ":" + hostname_obj["port"];
                                if (hostname_obj["is_tcp"] === 1) {
                                    full_select_list[hostname_obj["port_id"] + ":" + hostname_obj["hostname_id"]]["text"] += '/tcp';
                                } else {
                                    full_select_list[hostname_obj["port_id"] + ":" + hostname_obj["hostname_id"]]["text"] += '/udp';
                                }

                            }
                            full_select_list[hostname_obj["port_id"] + ":" + hostname_obj["hostname_id"]]["selected"] = "";
                        }

                        hosts_loaded = true;

                    });

                    $('#search_host')[0].oninput = function () {
                        value = $('#search_host')[0].value;
                        show_hosts(value);
                    };
                });

                alert_shown = false;

                function create_new_task(task_type) {
                    if (!alert_shown) {

                        // wait for receiving list of hosts

                        while (!hosts_loaded) {
                        }

                        tmp_list = JSON.parse(JSON.stringify(full_select_list));

                        alert_shown = true;
                        show_hosts("");

                        elems_list = $('#new_task_users')[0];
                        elems_list.innerHTML = '';

                        for (const [user_id, current_user] of Object.entries(users)) {
                            new_elem = document.createElement("option");
                            new_elem.value = user_id;
                            new_elem.text = current_user["email"] + " - " + current_user["fname"] + " " + current_user["lname"];
                            elems_list.add(new_elem);
                        }

                        elems_list = $('#new_task_teams')[0];
                        elems_list.innerHTML = '';

                        for (const [team_id, team_name] of Object.entries(teams)) {
                            new_elem = document.createElement("option");
                            new_elem.value = team_id;
                            new_elem.text = team_name;
                            elems_list.add(new_elem);
                        }

                        $('#new_task_users').dropdown();
                        $('#new_task_teams').dropdown();
                        $('#new_task_status').dropdown('set selected', task_type);
                        $('#new_task_criticality').dropdown();
                        $('#task_header')[0].innerHTML = 'Create a new task!';

                        $('#button_add')[0].style.display = 'inline';
                        $('#button_edit')[0].style.display = 'none';
                        $('#button_delete')[0].style.display = 'none';


                        $('.ui.modal')
                            .modal({
                                closable: false,
                                autofocus: false,
                                onDeny: function () {
                                },
                                onApprove: function () {
                                }
                            })
                            .modal('show')
                        ;
                        show_calendar("");
                    }
                }

                function cancel_new_task() {
                    alert_shown = false;
                    $('.ui.modal').modal('hide');
                }

                function submit_new_task() {
                    task_name = $('#task_name')[0].value;
                    task_description = $('#task_description')[0].value;
                    task_criticality = $('#new_task_criticality').dropdown('get value');
                    task_teams = $('#new_task_teams').dropdown('get value');
                    task_users = $('#new_task_users').dropdown('get value');
                    task_status = $('#new_task_status').dropdown('get value');
                    task_start = $('#rangestart').calendar('get focusDate');
                    task_end = $('#rangeend').calendar('get focusDate');

                    task_hosts = [];

                    for (key in tmp_list) {
                        if (tmp_list[key]["selected"] === "checked")
                            task_hosts.push(key)
                    }

                    if (task_name === "") {
                        $('body').toast({
                            class: 'error',
                            position: 'bottom right',
                            message: 'Need to set task name!'
                        });
                        return;
                    }

                    csrf_token = "{{ csrf_token() }}";
                    $.ajax({
                        type: "POST",
                        url: "/project/{{ current_project['id'] }}/new_task",
                        async: true,
                        data: {
                            "csrf_token": csrf_token,
                            "name": task_name,
                            "description": task_description,
                            "criticality": task_criticality,
                            "status": task_status,
                            "start_date": task_start.getTime() / 1000,
                            "end_date": task_end.getTime() / 1000,
                            "teams": JSON.stringify(task_teams),
                            "users": JSON.stringify(task_users),
                            "hosts": JSON.stringify(task_hosts)
                        },
                        success: function (json_response) {
                            if ("errors" in json_response) {
                                for (error_text of json_response["errors"]) {
                                    $('body').toast({
                                        class: 'error',
                                        position: 'bottom right',
                                        message: error_text
                                    });
                                }
                            } else {
                                $('body').toast({
                                    class: 'success',
                                    position: 'bottom right',
                                    message: "Success! Redirecting.."
                                });
                                location.reload();
                            }
                        }
                    });
                }

                function delete_prompt(func, message) {
                    if (confirm(message))
                        return true;
                    return false;
                };

                function move_task(task_id, status) {

                    csrf_token = "{{ csrf_token() }}";
                    $.ajax({
                        type: "POST",
                        url: "/project/{{ current_project['id'] }}/move_task",
                        async: true,
                        data: {
                            "csrf_token": csrf_token,
                            "task_id": task_id,
                            "status": status,
                        },
                        success: function (json_response) {
                            if ("errors" in json_response) {
                                for (error_text of json_response["errors"]) {
                                    $('body').toast({
                                        class: 'error',
                                        position: 'bottom right',
                                        message: error_text
                                    });
                                }
                            } else {
                                $('body').toast({
                                    class: 'success',
                                    position: 'bottom right',
                                    message: "Success! Reloading page.."
                                });
                                location.reload();
                            }
                        }
                    });
                }

                function delete_task(task_id) {

                    if (!delete_prompt(this, 'Are you sure to delete task ' + task_id + '?')) {
                        return;
                    }

                    csrf_token = "{{ csrf_token() }}";
                    $.ajax({
                        type: "POST",
                        url: "/project/{{ current_project['id'] }}/delete_task",
                        async: true,
                        data: {
                            "csrf_token": csrf_token,
                            "task_id": task_id
                        },
                        success: function (json_response) {
                            if ("errors" in json_response) {
                                for (error_text of json_response["errors"]) {
                                    $('body').toast({
                                        class: 'error',
                                        position: 'bottom right',
                                        message: error_text
                                    });
                                }
                            } else {
                                $('body').toast({
                                    class: 'success',
                                    position: 'bottom right',
                                    message: "Task was removed! Reloading page.."
                                });
                                location.reload();
                            }
                        }
                    });
                }

                current_task_id = ''

                function delete_current_task(){
                    delete_task(current_task_id);
                }

                function edit_task(task_id, task_obj) {
                    if (!alert_shown) {

                        // wait for receiving list of hosts

                        while (!hosts_loaded) {
                        }

                        current_task_id = task_id;

                        task_services = JSON.parse(task_obj.getAttribute('data-value'));
                        task_users = JSON.parse(task_obj.getAttribute('data-users'));
                        task_teams = JSON.parse(task_obj.getAttribute('data-teams'));
                        task_name = task_obj.getAttribute('data-name');
                        task_description = task_obj.getAttribute('data-description');
                        task_start_date = Number(task_obj.getAttribute('data-start-date'));
                        task_finish_date = Number(task_obj.getAttribute('data-finish-date'));
                        task_criticality = task_obj.getAttribute('data-criticality');
                        task_status = task_obj.getAttribute('data-status');

                        $('#button_add')[0].style.display = 'none';
                        $('#button_edit')[0].style.display = 'inline';
                        $('#button_delete')[0].style.display = 'inline';

                        tmp_list = JSON.parse(JSON.stringify(full_select_list));

                        for (const [port_id, hostnames_arr] of Object.entries(task_services)) {
                            // key - __port_id__:__hostname_id__
                            for (hostname_id of hostnames_arr) {
                                tmp_list[port_id + ":" + hostname_id]["selected"] = "checked";
                            }
                        }

                        alert_shown = true;
                        show_hosts("");

                        elems_list = $('#new_task_users')[0];
                        elems_list.innerHTML = '';

                        for (const [user_id, current_user] of Object.entries(users)) {
                            new_elem = document.createElement("option");
                            new_elem.value = user_id;
                            new_elem.text = current_user["email"] + " - " + current_user["fname"] + " " + current_user["lname"];
                            if (task_users.indexOf(user_id) > -1) {
                                new_elem.selected = true;
                            }

                            elems_list.add(new_elem);
                        }

                        elems_list = $('#new_task_teams')[0];
                        elems_list.innerHTML = '';

                        for (const [team_id, team_name] of Object.entries(teams)) {
                            new_elem = document.createElement("option");
                            new_elem.value = team_id;
                            new_elem.text = team_name;
                            elems_list.add(new_elem);
                            if (task_teams.indexOf(team_id) > -1) {
                                new_elem.selected = true;
                            }
                        }

                        $('#new_task_users').dropdown();
                        $('#new_task_teams').dropdown();
                        $('#new_task_status').dropdown('set selected', task_status);
                        $('#new_task_criticality').dropdown('set selected', task_criticality);
                        $('#task_header')[0].innerHTML = 'Edit task';

                        $('#task_name')[0].value = task_name;
                        $('#task_description')[0].value = task_description;

                        set_calendars(task_start_date, task_finish_date);


                        $('.ui.modal')
                            .modal({
                                closable: false,
                                autofocus: false,
                                onDeny: function () {
                                },
                                onApprove: function () {
                                }
                            })
                            .modal('show')
                        ;
                        show_calendar("");
                    }
                }

                function update_task() {
                    task_id = current_task_id;
                    task_name = $('#task_name')[0].value;
                    task_description = $('#task_description')[0].value;
                    task_criticality = $('#new_task_criticality').dropdown('get value');
                    task_teams = $('#new_task_teams').dropdown('get value');
                    task_users = $('#new_task_users').dropdown('get value');
                    task_status = $('#new_task_status').dropdown('get value');
                    task_start = $('#rangestart').calendar('get focusDate');
                    task_end = $('#rangeend').calendar('get focusDate');

                    task_hosts = [];

                    for (key in tmp_list) {
                        if (tmp_list[key]["selected"] === "checked")
                            task_hosts.push(key)
                    }

                    if (task_name === "") {
                        $('body').toast({
                            class: 'error',
                            position: 'bottom right',
                            message: 'Need to set task name!'
                        });
                        return;
                    }

                    csrf_token = "{{ csrf_token() }}";
                    $.ajax({
                        type: "POST",
                        url: "/project/{{ current_project['id'] }}/edit_task",
                        async: true,
                        data: {
                            "csrf_token": csrf_token,
                            "task_id": task_id,
                            "name": task_name,
                            "description": task_description,
                            "criticality": task_criticality,
                            "status": task_status,
                            "start_date": task_start.getTime() / 1000,
                            "end_date": task_end.getTime() / 1000,
                            "teams": JSON.stringify(task_teams),
                            "users": JSON.stringify(task_users),
                            "hosts": JSON.stringify(task_hosts)
                        },
                        success: function (json_response) {
                            if ("errors" in json_response) {
                                for (error_text of json_response["errors"]) {
                                    $('body').toast({
                                        class: 'error',
                                        position: 'bottom right',
                                        message: error_text
                                    });
                                }
                            } else {
                                $('body').toast({
                                    class: 'success',
                                    position: 'bottom right',
                                    message: "Success! Redirecting.."
                                });
                                location.reload();
                            }
                        }
                    });
                }
            </script>
            <div class="ui top attached tabular menu" id="tab_menu">
                <a class="active item" data-tab="stats"><h3 class="ui header"><i class="bar chart icon"></i>Statistics</h3></a>
                <a class="item" data-tab="todo"><h3 class="ui header"><i class="tasks icon"></i>TODO</h3></a>
            </div>
            <div class="ui bottom attached active tab segment" data-tab="stats">
                <div class="ui container" style="width: 100%;height: 90%">
                    <div class="ui grid" style="height: 100%">
                        <div class="ui column thirteen wide" style="height: 100%">
                            <div class="ui three column celled grid">
                                <div class="column" style="height: 100%">
                                    <!-- creds round -->
                                    <script>
                                        $(document).ready(function () {
                                            var options = {
                                                series: {{ json_pack(stats_dict['creds_array']) }},
                                                colors: ['rgba(255,69,96,0.85)', 'rgb(254, 176, 25)', 'rgba(0,227,150,0.85)', 'rgb(0, 143, 251)'],
                                                labels: ['Cleartext password', 'Password hash', 'Hash & Cleartext password', 'Just login/email'],
                                                chart: {
                                                    type: 'donut',
                                                    toolbar: {show: true}
                                                },
                                                legend: {
                                                    show: false
                                                },
                                                title: {
                                                    text: 'Found credentials',
                                                    align: 'left',
                                                    margin: 10,
                                                    offsetX: 0,
                                                    offsetY: 0,
                                                    floating: false,
                                                    style: {
                                                        fontSize: '14px',
                                                        fontWeight: 'bold',
                                                        fontFamily: undefined,
                                                        color: '#263238'
                                                    }
                                                }
                                            };
                                            var chart = new ApexCharts(document.querySelector("#stats_creds"), options);
                                            chart.render();
                                        });
                                    </script>
                                    <div id="stats_creds" style="width:100%; height:100%;"></div>
                                </div>
                                <div class="column" style="height: 100%">
                                    <!-- time left round -->
                                    <script>
                                        $(document).ready(function () {

                                                var options = {
                                                    series: [{{  stats_dict['project']['percents'] }}],
                                                    chart: {
                                                        type: 'radialBar',
                                                        toolbar: {show: true},
                                                    },
                                                    plotOptions: {
                                                        radialBar: {
                                                            hollow: {
                                                                margin: 15,
                                                                size: '70%',
                                                                image: '{% if external_img %}https://apexcharts.com/samples/assets/images/clock.png{% else %}/static/images/clock.png{% endif %}',
                                                                imageWidth: 64,
                                                                imageHeight: 64,
                                                                imageClipped: false
                                                            },
                                                            dataLabels: {
                                                                name: {
                                                                    show: false,
                                                                    color: '#fff'
                                                                },
                                                                value: {
                                                                    show: true,
                                                                    color: '#333',
                                                                    offsetY: 50,
                                                                    fontSize: '22px'
                                                                }
                                                            }
                                                        }
                                                    },
                                                    fill: {
                                                        type: 'image',
                                                        image: {
                                                            src: ['{% if external_img %}https://apexcharts.com/samples/assets/images/4274635880_809a4b9d0d_z.jpg{% else %}/static/images/stats_background.jpg{% endif %}'],
                                                        }
                                                    },
                                                    stroke: {
                                                        lineCap: 'round'
                                                    },
                                                    labels: ['Volatility'],
                                                    title: {
                                                        text: 'Time left',
                                                        align: 'left',
                                                        offsetX: 0,
                                                        offsetY: 0,
                                                        floating: false,
                                                        style: {
                                                            fontSize: '14px',
                                                            fontWeight: 'bold',
                                                            fontFamily: undefined,
                                                            color: '#263238'
                                                        }
                                                    },
                                                };

                                                var chart = new ApexCharts(document.querySelector("#stats_clock"), options);
                                                chart.render();
                                            }
                                        );
                                    </script>
                                    <div id="stats_clock"></div>
                                </div>
                                <div class="column" style="max-height: 100%">
                                    <!-- vulns round -->
                                    <script>
                                        $(document).ready(function () {
                                            var options = {
                                                series: {{ json_pack(stats_dict['issues_arr']) }},
                                                chart: {
                                                    type: 'radialBar',
                                                    toolbar: {
                                                        show: true,
                                                        height: 390
                                                    },
                                                },
                                                plotOptions: {
                                                    radialBar: {
                                                        offsetY: 0,
                                                        startAngle: 0,
                                                        endAngle: 270,
                                                        hollow: {
                                                            margin: 5,
                                                            size: '30%',
                                                            background: 'transparent',
                                                            image: undefined,
                                                        },
                                                        dataLabels: {
                                                            name: {
                                                                show: false,
                                                            },
                                                            value: {
                                                                show: false,
                                                            }
                                                        }
                                                    }
                                                },
                                                colors: ['rgba(255,69,96,0.85)', 'rgb(254, 176, 25)', 'rgba(0,227,150,0.85)', 'rgb(0, 143, 251)', 'rgba(119,93,208,0.85)'],
                                                labels: ['Critical', 'High', 'Medium', 'Low', 'Information'],
                                                legend: {
                                                    show: true,
                                                    floating: true,
                                                    fontSize: '16px',
                                                    position: 'left',
                                                    offsetX: -30,
                                                    offsetY: 15,
                                                    labels: {
                                                        useSeriesColors: true,
                                                    },
                                                    markers: {
                                                        size: 0
                                                    },
                                                    formatter: function (seriesName, opts) {
                                                        values_dict =
                                                        {{ json_pack(stats_dict['issues']) | safe }}
                                                        return seriesName + ":  " + values_dict[seriesName]
                                                    },
                                                    itemMargin: {
                                                        vertical: 3
                                                    },
                                                    backgroundColor: 'black'
                                                },
                                                responsive: [{
                                                    breakpoint: 480,
                                                    options: {
                                                        legend: {
                                                            show: false
                                                        }
                                                    }
                                                }],

                                                title: {
                                                    text: 'Issues',
                                                    align: 'left',
                                                    margin: 10,
                                                    offsetX: 0,
                                                    offsetY: 0,
                                                    floating: false,
                                                    style: {
                                                        fontSize: '14px',
                                                        fontWeight: 'bold',
                                                        fontFamily: undefined,
                                                        color: '#263238'
                                                    },
                                                }
                                            };

                                            var chart = new ApexCharts(document.querySelector("#stats_vulns"), options);
                                            chart.render();
                                        });
                                    </script>
                                    <div id="stats_vulns"></div>
                                </div>
                            </div>
                            <div class="ui two column celled grid">
                                <div class="column" style="max-height: 100%">
                                    <!-- hosts graph -->
                                    <script>
                                        $(document).ready(function () {
                                            var options = {
                                                series: [{
                                                    data: {{ json_pack(stats_dict['ports']['count']) }},
                                                    name: 'ports'
                                                }],
                                                chart: {
                                                    height: 350,
                                                    type: 'bar',
                                                    events: {
                                                        click: function (chart, w, e) {
                                                            // console.log(chart, w, e)
                                                        }
                                                    }
                                                },
                                                plotOptions: {
                                                    bar: {
                                                        borderRadius: 6,
                                                        columnWidth: '45%',
                                                        distributed: true,
                                                    }
                                                },
                                                dataLabels: {
                                                    enabled: false
                                                },
                                                xaxis: {
                                                    categories: {{ json_pack(stats_dict['ports']['names']) | safe }},
                                                    labels: {
                                                        style: {
                                                            fontSize: '12px'
                                                        }
                                                    }
                                                },
                                                title: {
                                                    text: 'Open ports',
                                                    align: 'left',
                                                    margin: 10,
                                                    offsetX: 0,
                                                    offsetY: 0,
                                                    floating: false,
                                                    style: {
                                                        fontSize: '14px',
                                                        fontWeight: 'bold',
                                                        fontFamily: undefined,
                                                        color: '#263238'
                                                    },
                                                }
                                            };

                                            var chart = new ApexCharts(document.querySelector("#stats_hosts"), options);
                                            chart.render();
                                        });
                                    </script>
                                    <div id="stats_hosts"></div>
                                </div>
                                <div class="column" style="max-height: 100%">
                                    <!-- services graph -->
                                    <script>
                                        $(document).ready(function () {
                                            var options = {
                                                series: [{
                                                    data: {{ json_pack(stats_dict['os_array']) }},
                                                    name: 'hosts'
                                                }],
                                                chart: {
                                                    height: 350,
                                                    type: 'bar',
                                                    events: {
                                                        click: function (chart, w, e) {
                                                            // console.log(chart, w, e)
                                                        }
                                                    }
                                                },
                                                labels: ['Windows', 'Linux', 'MacOS', 'Other'],
                                                plotOptions: {
                                                    bar: {
                                                        borderRadius: 6,
                                                        columnWidth: '45%',
                                                        distributed: true,
                                                    }
                                                },
                                                dataLabels: {
                                                    enabled: false
                                                },
                                                xaxis: {
                                                    categories: [
                                                        'Windows',
                                                        'Linux',
                                                        'MacOS',
                                                        'Other',
                                                    ],
                                                    labels: {
                                                        style: {
                                                            fontSize: '12px'
                                                        }
                                                    }
                                                },
                                                title: {
                                                    text: 'Hosts operation systems',
                                                    align: 'left',
                                                    margin: 10,
                                                    offsetX: 0,
                                                    offsetY: 0,
                                                    floating: false,
                                                    style: {
                                                        fontSize: '14px',
                                                        fontWeight: 'bold',
                                                        fontFamily: undefined,
                                                        color: '#263238'
                                                    },
                                                }
                                            };

                                            var chart = new ApexCharts(document.querySelector("#stats_services"), options);
                                            chart.render();
                                        });
                                    </script>
                                    <div id="stats_services"></div>
                                </div>
                            </div>
                        </div>
                        <div class="ui column three wide"></div>
                    </div>
                </div>
            </div>
            <div class="ui bottom attached tab segment" data-tab="todo" style="width:100%; height: 90%; margin-bottom:0; padding-bottom: 0px;">
                {% set tasks = db.select_project_tasks(current_project['id']) %}
                {% set services = {'obj': {}, 'port': {}, 'host': {}} %}
                <div class="ui grid divided" style="height: 100%">
                    <div class="four wide column" style="height: 100%">
                        <button class="ui button blue" style="width: 100%" onclick="create_new_task('todo');"><i class="icon tasks"></i>TO DO <i class="plus icon" style="float:right"></i></button>
                        <div class="ui container" style="width: 100%; height: calc(100% - 15px); overflow: auto; padding-top: 15px;">
                            {% for current_task in tasks %}
                                {% if current_task['status'] =='todo' %}
                                    <div class="ui card" style="background-color: unset; -webkit-box-shadow: unset;width: calc(100% - 2px); margin-left: 1px; border: solid {% if current_task['criticality']=='info' %}blue{% elif current_task['criticality']=='low' %}green{% elif current_task['criticality']=='medium' %}yellow{% elif current_task['criticality']=='high' %}orange{% else %}red{% endif %}">
                                        <div class="content">
                                            <div class="header">{{ current_task['name']|truncate(20, True) }}</div>
                                            {% if current_task['start_date'] and current_task['start_date'] != 0 %}
                                                <div class="meta">{{ format_date(current_task['start_date'],'%d.%m.%Y') }}{% else %}...{% endif %} -
                                            {% if current_time>=current_task['finish_date'] %}
                                                <span class="ui red text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% else %}
                                                <span class="ui text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% endif %}
                                            </div>
                                            <div class="description" style="max-height: 60px;">
                                                {{ (current_task['description'])|truncate(80, True) }}
                                            </div>
                                        </div>
                                        {% if json_unpack(current_task['services']) %}
                                            {% if services.update({'obj': json_unpack(current_task['services'])}) %}{% endif %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="server icon"></i>Hosts:
                                                </div>
                                                <div class="right floated author">
                                                    {% for port_id in services['obj'] %}
                                                        {% if services.update({'host': db.select_host_by_port_id(port_id)[0]}) %}{% endif %}
                                                        {% if services.update({'port': db.select_port(port_id)[0]}) %}{% endif %}
                                                        {% for hostname_id in services['obj'][port_id] %}
                                                            {% if hostname_id == '0' %}{{ services['host']['ip'] }}{% else %}{{ db.select_hostname(hostname_id)[0]['hostname'] }}{% endif %}{% if not (services['port']['is_tcp']==1 and services['port']['port'] == 0) %}:{{ services['port']['port'] }}{% if services['port']['is_tcp'] %}/tcp{% else %}/udp{% endif %}{% endif %}<br/>
                                                        {% endfor %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['users']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="user icon"></i>Users:
                                                </div>
                                                <div class="right floated author">
                                                    {% for user_id in json_unpack(current_task['users']) %}
                                                        {% if project_users[user_id]["fname"] != "" or project_users[user_id]["lname"] != "" %}
                                                            {{ project_users[user_id]["fname"] | truncate(10, True) }} {{ project_users[user_id]["lname"] | truncate(10, True) }}<br/>
                                                        {% else %}
                                                            {{ project_users[user_id]["email"]| truncate(20, True) }}<br/>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['teams']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="users icon"></i>Teams:
                                                </div>
                                                <div class="right floated author">
                                                    {% for team_id in json_unpack(current_task['teams']) %}
                                                        {{ project_teams[team_id] | truncate(20, True) }}<br/>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="extra content">
                                            <div class="ui five buttons">
                                                <button class="ui grey compact button" title="EDIT" onclick="edit_task('{{ current_task['id'] }}', this);"
                                                        data-name="{{ current_task['name'] }}"
                                                        data-description="{{ current_task['description'] }}"
                                                        data-start-date="{{ current_task['start_date'] }}"
                                                        data-finish-date="{{ current_task['finish_date'] }}"
                                                        data-criticality="{{ current_task['criticality'] }}"
                                                        data-status="{{ current_task['status'] }}"
                                                        data-value="{{ current_task['services'] }}"
                                                        data-users="{{ current_task['users'] }}" data-teams="{{ current_task['teams'] }}"><i class="edit icon"></i></button>
                                                <button class="ui red compact button" title="DELETE" onclick="delete_task('{{ current_task['id'] }}');"><i class="trash icon"></i></button>
                                                <button class="ui yellow compact button" title="IN PROGRESS" onclick="move_task('{{ current_task['id'] }}', 'progress');"><i class="icon hammer"></i></button>
                                                <button class="ui pink compact button" title="REVIEW" onclick="move_task('{{ current_task['id'] }}', 'review');"><i class="icon eye"></i></button>
                                                <button class="ui green compact button" title="DONE" onclick="move_task('{{ current_task['id'] }}', 'done');"><i class="icon check circle outline"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="four wide column" style="height: 100%">
                        <button class="ui button yellow" style="width: 100%" onclick="create_new_task('progress');"><i class="icon hammer"></i>IN PROGRESS <i class="plus icon" style="float:right"></i></button>
                        <div class="ui container" style="width: 100%; height: calc(100% - 15px); overflow: auto; padding-top: 15px;">
                            {% for current_task in tasks %}
                                {% if current_task['status'] =='progress' %}
                                    <div class="ui card" style="background-color: unset; -webkit-box-shadow: unset;width: calc(100% - 2px); margin-left: 1px; border: solid {% if current_task['criticality']=='info' %}blue{% elif current_task['criticality']=='low' %}green{% elif current_task['criticality']=='medium' %}yellow{% elif current_task['criticality']=='high' %}orange{% else %}red{% endif %}">
                                        <div class="content">
                                            <div class="header">{{ current_task['name']|truncate(20, True) }}</div>
                                            {% if current_task['start_date'] and current_task['start_date'] != 0 %}
                                                <div class="meta">{{ format_date(current_task['start_date'],'%d.%m.%Y') }}{% else %}...{% endif %} -
                                            {% if current_time>=current_task['finish_date'] %}
                                                <span class="ui red text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% else %}
                                                <span class="ui text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% endif %}
                                            </div>
                                            <div class="description" style="max-height: 60px;">
                                                {{ (current_task['description'])|truncate(80, True) }}
                                            </div>
                                        </div>
                                        {% if json_unpack(current_task['services']) %}
                                            {% if services.update({'obj': json_unpack(current_task['services'])}) %}{% endif %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="server icon"></i>Hosts:
                                                </div>
                                                <div class="right floated author">
                                                    {% for port_id in services['obj'] %}
                                                        {% if services.update({'host': db.select_host_by_port_id(port_id)[0]}) %}{% endif %}
                                                        {% if services.update({'port': db.select_port(port_id)[0]}) %}{% endif %}
                                                        {% for hostname_id in services['obj'][port_id] %}
                                                            {% if hostname_id == '0' %}{{ services['host']['ip'] }}{% else %}{{ db.select_hostname(hostname_id)[0]['hostname'] }}{% endif %}{% if not (services['port']['is_tcp']==1 and services['port']['port'] == 0) %}:{{ services['port']['port'] }}{% if services['port']['is_tcp'] %}/tcp{% else %}/udp{% endif %}{% endif %}<br/>
                                                        {% endfor %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['users']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="user icon"></i>Users:
                                                </div>
                                                <div class="right floated author">
                                                    {% for user_id in json_unpack(current_task['users']) %}
                                                        {% if project_users[user_id]["fname"] != "" or project_users[user_id]["lname"] != "" %}
                                                            {{ project_users[user_id]["fname"] | truncate(10, True) }} {{ project_users[user_id]["lname"] | truncate(10, True) }}<br/>
                                                        {% else %}
                                                            {{ project_users[user_id]["email"]| truncate(20, True) }}<br/>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['teams']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="users icon"></i>Teams:
                                                </div>
                                                <div class="right floated author">
                                                    {% for team_id in json_unpack(current_task['teams']) %}
                                                        {{ project_teams[team_id] | truncate(20, True) }}<br/>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="extra content">
                                            <div class="ui five buttons">
                                                <button class="ui grey compact button" title="EDIT" onclick="edit_task('{{ current_task['id'] }}', this);"
                                                        data-name="{{ current_task['name'] }}"
                                                        data-description="{{ current_task['description'] }}"
                                                        data-start-date="{{ current_task['start_date'] }}"
                                                        data-finish-date="{{ current_task['finish_date'] }}"
                                                        data-criticality="{{ current_task['criticality'] }}"
                                                        data-status="{{ current_task['status'] }}"
                                                        data-value="{{ current_task['services'] }}"
                                                        data-users="{{ current_task['users'] }}" data-teams="{{ current_task['teams'] }}"><i class="edit icon"></i></button>
                                                <button class="ui red compact button" title="DELETE" onclick="delete_task('{{ current_task['id'] }}');"><i class="trash icon"></i></button>
                                                <button class="ui blue compact button" title="TO DO" onclick="move_task('{{ current_task['id'] }}', 'todo');"><i class="icon tasks"></i></button>
                                                <button class="ui pink compact button" title="REVIEW" onclick="move_task('{{ current_task['id'] }}', 'review');"><i class="icon eye"></i></button>
                                                <button class="ui green compact button" title="DONE" onclick="move_task('{{ current_task['id'] }}', 'done');"><i class="icon check circle outline"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="four wide column" style="height: 100%">
                        <button class="ui button pink" style="width: 100%" onclick="create_new_task('review');"><i class="icon eye"></i>REVIEW <i class="plus icon" style="float:right"></i></button>
                        <div class="ui container" style="width: 100%; height: calc(100% - 15px); overflow: auto; padding-top: 15px;">
                            {% for current_task in tasks %}
                                {% if current_task['status'] =='review' %}
                                    <div class="ui card" style="background-color: unset; -webkit-box-shadow: unset;width: calc(100% - 2px); margin-left: 1px; border: solid {% if current_task['criticality']=='info' %}blue{% elif current_task['criticality']=='low' %}green{% elif current_task['criticality']=='medium' %}yellow{% elif current_task['criticality']=='high' %}orange{% else %}red{% endif %}">
                                        <div class="content">
                                            <div class="header">{{ current_task['name']|truncate(20, True) }}</div>
                                            {% if current_task['start_date'] and current_task['start_date'] != 0 %}
                                                <div class="meta">{{ format_date(current_task['start_date'],'%d.%m.%Y') }}{% else %}...{% endif %} -
                                            {% if current_time>=current_task['finish_date'] %}
                                                <span class="ui red text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% else %}
                                                <span class="ui text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% endif %}
                                            </div>
                                            <div class="description" style="max-height: 60px;">
                                                {{ (current_task['description'])|truncate(80, True) }}
                                            </div>
                                        </div>
                                        {% if json_unpack(current_task['services']) %}
                                            {% if services.update({'obj': json_unpack(current_task['services'])}) %}{% endif %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="server icon"></i>Hosts:
                                                </div>
                                                <div class="right floated author">
                                                    {% for port_id in services['obj'] %}
                                                        {% if services.update({'host': db.select_host_by_port_id(port_id)[0]}) %}{% endif %}
                                                        {% if services.update({'port': db.select_port(port_id)[0]}) %}{% endif %}
                                                        {% for hostname_id in services['obj'][port_id] %}
                                                            {% if hostname_id == '0' %}{{ services['host']['ip'] }}{% else %}{{ db.select_hostname(hostname_id)[0]['hostname'] }}{% endif %}{% if not (services['port']['is_tcp']==1 and services['port']['port'] == 0) %}:{{ services['port']['port'] }}{% if services['port']['is_tcp'] %}/tcp{% else %}/udp{% endif %}{% endif %}<br/>
                                                        {% endfor %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['users']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="user icon"></i>Users:
                                                </div>
                                                <div class="right floated author">
                                                    {% for user_id in json_unpack(current_task['users']) %}
                                                        {% if project_users[user_id]["fname"] != "" or project_users[user_id]["lname"] != "" %}
                                                            {{ project_users[user_id]["fname"] | truncate(10, True) }} {{ project_users[user_id]["lname"] | truncate(10, True) }}<br/>
                                                        {% else %}
                                                            {{ project_users[user_id]["email"]| truncate(20, True) }}<br/>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['teams']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="users icon"></i>Teams:
                                                </div>
                                                <div class="right floated author">
                                                    {% for team_id in json_unpack(current_task['teams']) %}
                                                        {{ project_teams[team_id] | truncate(20, True) }}<br/>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="extra content">
                                            <div class="ui five buttons">
                                                <button class="ui grey compact button" title="EDIT" onclick="edit_task('{{ current_task['id'] }}', this);"
                                                        data-name="{{ current_task['name'] }}"
                                                        data-description="{{ current_task['description'] }}"
                                                        data-start-date="{{ current_task['start_date'] }}"
                                                        data-finish-date="{{ current_task['finish_date'] }}"
                                                        data-criticality="{{ current_task['criticality'] }}"
                                                        data-status="{{ current_task['status'] }}"
                                                        data-value="{{ current_task['services'] }}"
                                                        data-users="{{ current_task['users'] }}" data-teams="{{ current_task['teams'] }}"><i class="edit icon"></i></button>
                                                <button class="ui red compact button" title="DELETE" onclick="delete_task('{{ current_task['id'] }}');"><i class="trash icon"></i></button>
                                                <button class="ui blue compact button" title="TO DO" onclick="move_task('{{ current_task['id'] }}', 'todo');"><i class="tasks icon"></i></button>
                                                <button class="ui yellow compact button" title="IN PROGRESS" onclick="move_task('{{ current_task['id'] }}', 'progress');"><i class="icon hammer"></i></button>
                                                <button class="ui green compact button" title="DONE" onclick="move_task('{{ current_task['id'] }}', 'done');"><i class="icon check circle outline"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="four wide column" style="height: 100%">
                        <button class="ui button green" style="width: 100%" onclick="create_new_task('done');"><i class="icon check circle outline"></i>DONE <i class="plus icon" style="float:right"></i></button>
                        <div class="ui container" style="width: 100%; height: calc(100% - 15px); overflow: auto; padding-top: 15px;">
                            {% for current_task in tasks %}
                                {% if current_task['status'] =='done' %}
                                    <div class="ui card" style="background-color: unset; -webkit-box-shadow: unset;width: calc(100% - 2px); margin-left: 1px; border: solid {% if current_task['criticality']=='info' %}blue{% elif current_task['criticality']=='low' %}green{% elif current_task['criticality']=='medium' %}yellow{% elif current_task['criticality']=='high' %}orange{% else %}red{% endif %}">
                                        <div class="content">
                                            <div class="header">{{ current_task['name']|truncate(20, True) }}</div>
                                            {% if current_task['start_date'] and current_task['start_date'] != 0 %}
                                                <div class="meta">{{ format_date(current_task['start_date'],'%d.%m.%Y') }}{% else %}...{% endif %} -
                                            {% if current_time>=current_task['finish_date'] %}
                                                <span class="ui red text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% else %}
                                                <span class="ui text">{{ format_date(current_task['finish_date'],'%d.%m.%Y') }}</span>
                                            {% endif %}
                                            </div>
                                            <div class="description" style="max-height: 60px;">
                                                {{ (current_task['description'])|truncate(80, True) }}
                                            </div>
                                        </div>
                                        {% if json_unpack(current_task['services']) %}
                                            {% if services.update({'obj': json_unpack(current_task['services'])}) %}{% endif %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="server icon"></i>Hosts:
                                                </div>
                                                <div class="right floated author">
                                                    {% for port_id in services['obj'] %}
                                                        {% if services.update({'host': db.select_host_by_port_id(port_id)[0]}) %}{% endif %}
                                                        {% if services.update({'port': db.select_port(port_id)[0]}) %}{% endif %}
                                                        {% for hostname_id in services['obj'][port_id] %}
                                                            {% if hostname_id == '0' %}{{ services['host']['ip'] }}{% else %}{{ db.select_hostname(hostname_id)[0]['hostname'] }}{% endif %}{% if not (services['port']['is_tcp']==1 and services['port']['port'] == 0) %}:{{ services['port']['port'] }}{% if services['port']['is_tcp'] %}/tcp{% else %}/udp{% endif %}{% endif %}<br/>
                                                        {% endfor %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['users']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="user icon"></i>Users:
                                                </div>
                                                <div class="right floated author">
                                                    {% for user_id in json_unpack(current_task['users']) %}
                                                        {% if project_users[user_id]["fname"] != "" or project_users[user_id]["lname"] != "" %}
                                                            {{ project_users[user_id]["fname"] | truncate(10, True) }} {{ project_users[user_id]["lname"] | truncate(10, True) }}<br/>
                                                        {% else %}
                                                            {{ project_users[user_id]["email"]| truncate(20, True) }}<br/>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% if json_unpack(current_task['teams']) %}
                                            <div class="content">
                                                <div class="left floated">
                                                    <i class="users icon"></i>Teams:
                                                </div>
                                                <div class="right floated author">
                                                    {% for team_id in json_unpack(current_task['teams']) %}
                                                        {{ project_teams[team_id] | truncate(20, True) }}<br/>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="extra content">
                                            <div class="ui five buttons">
                                                <button class="ui grey compact button" title="EDIT" onclick="edit_task('{{ current_task['id'] }}', this);"
                                                        data-name="{{ current_task['name'] }}"
                                                        data-description="{{ current_task['description'] }}"
                                                        data-start-date="{{ current_task['start_date'] }}"
                                                        data-finish-date="{{ current_task['finish_date'] }}"
                                                        data-criticality="{{ current_task['criticality'] }}"
                                                        data-status="{{ current_task['status'] }}"
                                                        data-value="{{ current_task['services'] }}"
                                                        data-users="{{ current_task['users'] }}" data-teams="{{ current_task['teams'] }}"><i class="edit icon"></i></button>
                                                <button class="ui red compact button" title="DELETE" onclick="delete_task('{{ current_task['id'] }}');"><i class="trash icon"></i></button>
                                                <button class="ui blue compact button" title="TO DO" onclick="move_task('{{ current_task['id'] }}', 'todo');"><i class="icon tasks"></i></button>
                                                <button class="ui yellow compact button" title="IN PROGRESS" onclick="move_task('{{ current_task['id'] }}', 'progress');"><i class="icon hammer"></i></button>
                                                <button class="ui pink compact button" title="REVIEW" onclick="move_task('{{ current_task['id'] }}', 'review');"><i class="icon eye"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="ui modal" id="new_task" style="width: 800px;">
                    <i class="close big red icon" onclick="cancel_new_task();" style="top: unset; right: 0rem;" ></i>
                    <div class="header divided" id="task_header">
                        Create a new task!
                    </div>
                    <div class="ui form" style="margin: 5px;">
                        <div class="ui grid">
                            <div class="two column row">
                                <div class="ten wide column">
                                    <div class="two fields">
                                        <div class="field">
                                            <label>Start date</label>
                                            <div class="ui calendar {% if request.cookies.get('darkmode')=='1' %}inverted{% endif %}" id="rangestart">
                                                <div class="ui input left icon">
                                                    <i class="calendar icon"></i>
                                                    <input type="text" name="start_date" id="start_date" placeholder="Start">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="field">
                                            <label>End date</label>
                                            <div class="ui calendar {% if request.cookies.get('darkmode')=='1' %}inverted{% endif %}" id="rangeend">
                                                <div class="ui input left icon">
                                                    <i class="calendar icon"></i>
                                                    <input type="text" name="end_date" id="end_date" placeholder="End">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ui field">
                                        <div class="ui labeled input">
                                            <div class="ui label" style="width: 125px;">
                                                <i class="check square outline icon"></i>Name:
                                            </div>
                                            <input type="text" id="task_name" name="name" required placeholder="Name of task" maxlength="30" value="">
                                        </div>
                                    </div>
                                    <div class="ui field">
                                        <div class="ui labeled input">
                                            <div class="ui label" style="width: 125px;">
                                                <i class="sticky note outline icon"></i>Description:
                                            </div>
                                            <textarea id="task_description" rows="4" name="description" placeholder="Task description"></textarea>
                                        </div>
                                    </div>
                                    <div class="ui field">
                                        <div class="ui labeled input">
                                            <div class="ui label" style="width: 125px;">
                                                <i class="exclamation triangle icon"></i>Criticality:
                                            </div>
                                            <div class="ui fluid selection dropdown" id="new_task_criticality">
                                                <input type="hidden" name="criticality" value="info">
                                                <i class="dropdown icon"></i>
                                                <div class="default text">Select criticality</div>
                                                <div class="menu">
                                                    <div class="item" data-value="info"><i class="warning circle blue icon"></i>Information</div>
                                                    <div class="item" data-value="low"><i class="warning circle green icon"></i>Low</div>
                                                    <div class="item" data-value="medium"><i class="warning circle yellow icon"></i>Medium</div>
                                                    <div class="item" data-value="high"><i class="warning circle orange icon"></i>High</div>
                                                    <div class="item" data-value="critical"><i class="warning circle red icon"></i>Critical</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ui field">
                                        <div class="ui labeled input">
                                            <div class="ui label" style="width: 125px;">
                                                <i class="users icon"></i>Teams:
                                            </div>
                                            <select class="ui fluid search dropdown" multiple="" id="new_task_teams">
                                                <option value="">State</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="ui field">
                                        <div class="ui labeled input">
                                            <div class="ui label" style="width: 125px;">
                                                <i class="user icon"></i>Users:
                                            </div>
                                            <select class="ui fluid search dropdown" multiple="" id="new_task_users">
                                                <option value="">State</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="ui field">
                                        <div class="ui labeled input">
                                            <div class="ui label" style="width: 125px;">
                                                <i class="info circle icon"></i>Status:
                                            </div>
                                            <div class="ui fluid selection dropdown" id="new_task_status">
                                                <i class="dropdown icon"></i>
                                                <div class="default text">Select status</div>
                                                <div class="menu">
                                                    <div class="item blue" data-value="todo"><i class="icon tasks"></i>TODO</div>
                                                    <div class="item" data-value="progress"><i class="icon hammer"></i>IN PROGRESS</div>
                                                    <div class="item" data-value="review"><i class="icon eye"></i>REVIEW</div>
                                                    <div class="item" data-value="done"><i class="icon check circle outline"></i>DONE</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" id="button_add" class="ui blue button" style="width: 125px;" onclick="submit_new_task();"><i class="plus icon"></i>Add</button>
                                    <button type="button" id="button_edit" class="ui blue button" style="width: 125px;" onclick="update_task();"><i class="edit icon"></i>Edit</button>
                                    <button type="button" id="button_delete" class="ui red button" style="width: 125px;" onclick="delete_current_task();"><i class="trash icon"></i>Delete</button>

                                </div>
                                <div class="six wide column">
                                    <div class="ui field">
                                        <label style="margin-bottom: 0px;">Hosts</label>
                                        <div class="ui dropdown" id="new_task_hosts" style="width: 100%; min-width: 100%">
                                            <div class="menu transition visible" style="width: 90%; margin-top: -8px; height:410px;">
                                                <div class="ui icon search input">
                                                    <i class="search icon"></i>
                                                    <input type="text" name="Search" placeholder="Search&hellip;" id="search_host">
                                                </div>
                                                <div class="scrolling menu" style="max-height: 343px;" id="hosts_list">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include 'footer.html' %}
</div>
</div>
</body>
</html>